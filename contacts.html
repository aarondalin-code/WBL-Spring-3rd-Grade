
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contacts â€¢ WBL 3rd Grade 2026</title>
  <link rel="stylesheet" href="./styles.css?v=wbl2026" />
</head>

<body class="watermarkPage contactsPage hasHamburger">
<header class="siteHeader">
  <div class="navWrap">

    <!-- Mobile Hamburger -->
    <button
      class="navToggle"
      type="button"
      aria-label="Open menu"
      aria-expanded="false"
      aria-controls="siteNav"
    >
      <span></span><span></span><span></span>
    </button>

    <!-- Overlay -->
    <div class="navOverlay" aria-hidden="true"></div>

    <!-- Navigation -->
    <nav class="nav" id="siteNav">
      <a href="./">Home</a>
      <a href="./schedule.html">Schedule/Scores</a>
      <a href="./standings.html">Standings</a>
      <!-- Add Playoffs later when we build playoffs.html -->
      <a href="./teams.html">Teams</a>
      <a href="./rules.html">Rules</a>
      <a href="./contacts.html" class="active">Contacts</a>
      <a href="./gallery.html">Gallery</a>
      <a href="./uploads.html">Uploads</a>
    </nav>
  </div>

  <div class="brandCenter">
    <img src="./logo.png" alt="WBL Logo" class="logoImage">
    <h1>WBL 3rd Grade 2026</h1>
    <div class="tagline">Contacts</div>
  </div>
</header>

<main class="wrap">
  <section class="docSection">
    <h2>Contacts</h2>
    <p class="muted">Head coaches + contact info.</p>

    <div class="card">
      <div class="cardBody">
        <div id="contactsGrid" class="contactsGrid"></div>
        <p class="muted small" style="margin-top:12px;">
          Tip: Team names link to rosters.
        </p>
      </div>
    </div>
  </section>
</main>

<script src="./data.js"></script>

<script>
  // -----------------------------
  // Helpers
  // -----------------------------
  function safe(v){ return String(v ?? "").trim(); }

  function phoneDigits(phone){
    return safe(phone).replace(/\D/g, "");
  }

  async function fetchCsv(url){
    if (!url) throw new Error("Missing TEAMS_CSV_URL in data.js");
    const bust = (url.includes("?") ? "&" : "?") + "t=" + Date.now();
    const res = await fetch(url + bust, { cache: "no-store" });
    if (!res.ok) throw new Error(`Failed to fetch teams CSV (${res.status})`);
    return await res.text();
  }

  // Robust CSV parser (quoted commas safe)
  function parseCsv(text) {
    const rows = [];
    let row = [];
    let cur = "";
    let inQuotes = false;

    for (let i = 0; i < text.length; i++) {
      const ch = text[i];
      const next = text[i + 1];

      if (ch === '"') {
        if (inQuotes && next === '"') { cur += '"'; i++; }
        else inQuotes = !inQuotes;
        continue;
      }

      if (!inQuotes && ch === ",") { row.push(cur); cur = ""; continue; }

      if (!inQuotes && (ch === "\n" || ch === "\r")) {
        if (ch === "\r" && next === "\n") i++;
        row.push(cur); cur = "";
        if (row.some(v => safe(v) !== "")) rows.push(row);
        row = [];
        continue;
      }

      cur += ch;
    }

    row.push(cur);
    if (row.some(v => safe(v) !== "")) rows.push(row);

    const headers = (rows.shift() || []).map(h => safe(h).replace(/\s+/g, ""));
    return rows
      .filter(r => r.some(x => safe(x) !== ""))
      .map(r => {
        const obj = {};
        headers.forEach((h, idx) => obj[h] = safe(r[idx]));
        return obj;
      });
  }

  function buildCard(team){
    const teamName = safe(team.TeamName);
    const slug = safe(team.TeamSlug);

    const teamHref = `./team.html?team=${encodeURIComponent(slug)}`;

    const coachName  = safe(team.CoachName);
    const coachEmail = safe(team.CoachEmail);
    const coachPhone = safe(team.CoachPhone);

    const logo = safe(team.TeamLogo) || (window.DEFAULT_TEAM_LOGO || "./logo.png");

    const el = document.createElement("div");
    el.className = "contactTile";

    el.innerHTML = `
      <span class="contactAccent" aria-hidden="true"></span>

      <div class="contactTop">
        <img class="contactLogo" src="${logo}" alt="${teamName} logo"
             onerror="this.onerror=null; this.src='./logo.png';">
        <div class="contactTopText">
          <a class="contactTeamLink" href="${teamHref}">${teamName}</a>
          <div class="contactSub muted small">Head Coach</div>
        </div>
      </div>

      <div class="contactBody">
        <div class="contactCoachName">${coachName && coachName.toLowerCase() !== "tbd" ? coachName : "TBD"}</div>

        <div class="contactLinks">
          ${coachPhone && coachPhone.toLowerCase() !== "tbd"
            ? `<a class="contactLink" href="tel:${phoneDigits(coachPhone)}">${coachPhone}</a>`
            : ""
          }
          ${coachEmail && coachEmail.toLowerCase() !== "tbd"
            ? `<a class="contactLink" href="mailto:${coachEmail}">${coachEmail}</a>`
            : ""
          }
        </div>
      </div>
    `;

    return el;
  }

  (async function init(){
    const grid = document.getElementById("contactsGrid");
    grid.innerHTML = "";

    try {
      const csv = await fetchCsv(window.SHEET?.TEAMS_CSV_URL);
      const rows = parseCsv(csv);

      const teams = rows
        .map(r => ({
          TeamName: safe(r.TeamName),
          TeamSlug: safe(r.TeamSlug),
          TeamLogo: safe(r.TeamLogo),
          CoachName: safe(r.CoachName),
          CoachEmail: safe(r.CoachEmail),
          CoachPhone: safe(r.CoachPhone),
        }))
        .filter(t => t.TeamName && t.TeamSlug)
        .sort((a,b) => a.TeamName.localeCompare(b.TeamName));

      for (const t of teams){
        grid.appendChild(buildCard(t));
      }

      if (!teams.length){
        grid.innerHTML = `<div class="muted">No teams found. Check your Teams CSV headers (TeamName, TeamSlug, TeamLogo, CoachName, CoachEmail, CoachPhone).</div>`;
      }
    } catch (err) {
      console.error(err);
      grid.innerHTML = `<div class="muted">Contacts page error: check TEAMS_CSV_URL and your Teams tab headers.</div>`;
      alert("Contacts page error: check TEAMS_CSV_URL in data.js and make sure the Teams tab is published to CSV.");
    }
  })();
</script>

<script src="./nav.js"></script>
</body>
</html>
