<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Team â€¢ WBL 3rd Grade 2026</title>
  <link rel="stylesheet" href="./styles.css?v=wbl2026" />
</head>

<body class="watermarkPage teamPage hasHamburger">
<header class="siteHeader">
  <div class="navWrap">
    <button class="navToggle" type="button" aria-label="Open menu">
      <span></span><span></span><span></span>
    </button>

    <div class="navOverlay"></div>

    <nav class="nav" id="siteNav">
      <a href="./">Home</a>
      <a href="./schedule.html">Schedule/Scores</a>
      <a href="./standings.html">Standings</a>
      <a href="./teams.html">Teams</a>
      <a href="./playoffs.html">Playoffs</a>
      <a href="./rules.html">Rules</a>
      <a href="./contacts.html">Contacts</a>
      <a href="./gallery.html">Gallery</a>
      <a href="./uploads.html">Uploads</a>
    </nav>
  </div>

  <div class="brandCenter">
    <img src="./logo.png" alt="WBL Logo" class="logoImage">
    <h1>WBL 3rd Grade 2026</h1>
    <div class="tagline">Team Roster</div>
  </div>
</header>

<main class="wrap">

  <!-- TEAM HEADER BLOCK -->
  <section class="card" style="margin-top:12px;">
    <div class="cardBody">
      <div class="teamHeaderBlock" id="teamHeaderBlock">

        <div class="teamHeaderLeft">
          <img id="teamLogo" class="teamHeaderLogo" src="./logo.png" alt="Team Logo">
          <div>
            <div class="muted small">Team</div>
            <h2 id="teamName" style="margin:0;">Team</h2>
          </div>
        </div>

        <div class="coachCard">
          <div class="coachTitleCenter">
            <div class="coachLabel">Head Coach</div>
            <div class="coachName" id="coachName">TBD</div>
          </div>

          <div class="coachLinks">
            <a id="coachEmail" class="coachLink" style="display:none;"></a>
            <a id="coachPhone" class="coachLink" style="display:none;"></a>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- ROSTER -->
  <section class="card" style="margin-top:14px;">
    <div class="cardBody">
      <h3 style="margin:0 0 10px 0;">Roster</h3>
      <div id="rosterGrid" class="rosterGrid"></div>
      <p id="rosterMsg" class="muted small" style="margin-top:12px;"></p>
    </div>
  </section>

</main>

<!-- PLAYER MODAL -->
<div id="modalOverlay" class="modalOverlay">
  <div class="modalCard">
    <button class="modalClose" id="modalCloseBtn">âœ•</button>
    <div id="modalContent"></div>
  </div>
</div>

<script src="./data.js"></script>

<script>
function safe(v){ return String(v ?? "").trim(); }

function getParam(name){
  return new URLSearchParams(window.location.search).get(name) || "";
}

async function fetchCsv(url) {
  const bust = (url.includes("?") ? "&" : "?") + "t=" + Date.now();
  const res = await fetch(url + bust);
  return await res.text();
}

function parseCsv(text){
  const rows = text.trim().split("\n").map(r => r.split(","));
  const headers = rows.shift().map(h => h.trim());
  return rows.map(r => {
    const obj = {};
    headers.forEach((h,i)=> obj[h.trim()] = safe(r[i]));
    return obj;
  });
}

function playerPhotoSrc(player){
  const id = safe(player.PlayerID);
  return id ? `./player-photos/${id}.jpg` : window.DEFAULT_PLAYER_PHOTO;
}

function openModal(html){
  const overlay = document.getElementById("modalOverlay");
  document.getElementById("modalContent").innerHTML = html;
  overlay.classList.add("open");
  document.body.classList.add("noScroll");
}

function closeModal(){
  document.getElementById("modalOverlay").classList.remove("open");
  document.body.classList.remove("noScroll");
}

document.getElementById("modalCloseBtn").onclick = closeModal;
document.getElementById("modalOverlay").onclick = e => {
  if (e.target.id === "modalOverlay") closeModal();
};

(async function init(){
  const slug = safe(getParam("team"));
  if (!slug) return;

  const teamsCsv = await fetchCsv(window.SHEET.TEAMS_CSV_URL);
  const teams = parseCsv(teamsCsv);

  const team = teams.find(t => safe(t.TeamSlug) === slug);
  if (!team) return;

  // Header content
  document.getElementById("teamName").textContent = team.TeamName;
  document.getElementById("coachName").textContent = team.CoachName || "TBD";

  const logo = team.TeamLogo || "./logo.png";
  document.getElementById("teamLogo").src = logo;

  // ðŸ”¥ Watermark Injection (this is the new part)
  document.documentElement.style.setProperty(
    "--teamWatermark",
    `url("${logo}")`
  );

  // Coach links
  if (team.CoachEmail){
    const el = document.getElementById("coachEmail");
    el.href = `mailto:${team.CoachEmail}`;
    el.textContent = team.CoachEmail;
    el.style.display = "inline-flex";
  }

  if (team.CoachPhone){
    const el = document.getElementById("coachPhone");
    el.href = `tel:${team.CoachPhone.replace(/[^\d+]/g,"")}`;
    el.textContent = team.CoachPhone;
    el.style.display = "inline-flex";
  }

  // Roster
  const rosterCsv = await fetchCsv(window.SHEET.ROSTER_CSV_URL);
  const roster = parseCsv(rosterCsv).filter(p => safe(p.TeamSlug) === slug);

  const grid = document.getElementById("rosterGrid");

  roster.forEach(p=>{
    const photo = playerPhotoSrc(p);
    const btn = document.createElement("button");
    btn.className = "playerCardBtn";

    btn.innerHTML = `
      <div class="playerCardRow">
        <div class="playerThumb">
          <img src="${photo}"
               onerror="this.onerror=null;this.src='${window.DEFAULT_PLAYER_PHOTO}'">
        </div>
        <div>
          <div style="font-weight:900;">${p.PlayerName}</div>
          <div class="muted small">${p.Position || ""}</div>
        </div>
      </div>
    `;

    btn.onclick = ()=>{
      openModal(`
        <div class="profileHeader">
          <div class="profilePhoto">
            <img src="${photo}"
                 onerror="this.onerror=null;this.src='${window.DEFAULT_PLAYER_PHOTO}'">
          </div>
          <div>
            <h3>${p.PlayerName}</h3>
            <div class="muted">${team.TeamName}</div>
          </div>
        </div>
      `);
    };

    grid.appendChild(btn);
  });

})();
</script>

<script src="./nav.js"></script>
</body>
</html>
